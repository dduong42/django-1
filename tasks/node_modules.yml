#
# npm install
#
# Input   : django_root (optional)
#

- name: "npm yes or not"
  stat:
    path: "{{ django_root }}/package.json"
  register: "st"

- name: "Install packages based on package.json"
  command: "npm install {% if not django_debug %}--production{% endif %}"
  when: "st.stat.exists == True"

#
# TODO Try the npm module once Ansible 2.10 is released.
# Today it doesn't work because it doesn't check for devDependencies in the
# output of "npm list --json --long".
# https://github.com/ansible-collections/community.general/blob/master/plugins/modules/packaging/language/npm.py#L202
#
# npm:
#   path: "{{ django_root }}"
#   production: "{{ not django_debug }}"
